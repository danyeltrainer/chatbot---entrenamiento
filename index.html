<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Integral de Nutrici√≥n y Entrenamiento por Dany el Trainer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .chat-link {
            text-decoration: underline;
            font-weight: 600;
            color: #ef4444;
        }
        .dark .chat-link {
            color: #f87171;
        }
        .option-btn {
            transition: all 0.2s ease-in-out;
        }
        .option-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .styled-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 8px;
            margin-top: 1rem;
        }
        .styled-table th, .styled-table td {
            border: 2px solid #4b5563;
            padding: 0.75rem;
            text-align: left;
            font-size: 0.875rem;
        }
        .dark .styled-table th, .dark .styled-table td {
            border-color: #9ca3af;
        }
        .styled-table th {
            background-color: #1f2937;
            color: #f9fafb;
            font-weight: 600;
        }
        .styled-table td {
            background-color: #e5e7eb;
            color: #111827;
        }
        .dark .styled-table td {
            background-color: #4b5563;
            color: #f3f4f6;
        }
        .training-card {
            border-left: 4px solid #ef4444;
            background-color: #fef2f2;
            color: #1f2937;
        }
        .dark .training-card {
            background-color: #991b1b;
            color: #f9fafb;
        }
        .recipe-card {
            border-left: 4px solid #10b981;
            background-color: #f0fdf4;
            color: #1f2937;
        }
        .dark .recipe-card {
            background-color: #064e3b;
            color: #f9fafb;
        }
        .info-card {
            border-left: 4px solid #3b82f6;
            background-color: #eff6ff;
            color: #1f2937;
        }
        .dark .info-card {
            background-color: #1e3a8a;
            color: #f9fafb;
        }
        .guide-card {
            border-left: 4px solid #8b5cf6;
            background-color: #faf5ff;
            color: #1f2937;
        }
        .dark .guide-card {
            background-color: #5b21b6;
            color: #f9fafb;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-4px); }
        }
        .animate-bounce-slow {
            animation: bounce 1.2s infinite;
        }
        /* Mejoras para m√≥vil */
        @media (max-width: 768px) {
            .styled-table {
                font-size: 0.75rem;
            }
            .styled-table th, .styled-table td {
                padding: 0.5rem;
            }
            .option-btn {
                font-size: 0.75rem;
                padding: 0.5rem 0.75rem;
            }
        }
        /* Scroll suave */
        .chat-message {
            scroll-margin-top: 20px;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 flex flex-col items-center justify-center min-h-screen p-2 sm:p-4">

    <div class="w-full max-w-2xl bg-white dark:bg-gray-800 rounded-2xl shadow-lg flex flex-col h-[95vh] sm:h-[90vh]">
        <header class="bg-gradient-to-r from-red-600 to-orange-500 text-white p-3 sm:p-4 rounded-t-2xl flex items-center shadow-md">
            <div class="w-10 h-10 sm:w-12 sm:h-12 bg-white rounded-full flex items-center justify-center mr-3 sm:mr-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 sm:h-8 sm:w-8 text-red-600" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M10 3.5a1.5 1.5 0 011.5 1.5v2.5a1.5 1.5 0 01-3 0V5A1.5 1.5 0 0110 3.5zM3.5 10a1.5 1.5 0 00-1.5 1.5v2.5a1.5 1.5 0 003 0V11.5A1.5 1.5 0 003.5 10zm13 0a1.5 1.5 0 00-1.5 1.5v2.5a1.5 1.5 0 003 0V11.5a1.5 1.5 0 00-1.5-1.5z" />
                </svg>
            </div>
            <div>
                <h1 class="text-lg sm:text-xl font-bold">Chat de Nutrici√≥n y Entrenamiento</h1>
                <p class="text-xs sm:text-sm opacity-80">Por Dany el Trainer</p>
            </div>
        </header>

        <main id="chat-window" class="flex-1 p-3 sm:p-6 overflow-y-auto space-y-3 sm:space-y-4">
            <!-- Los mensajes del chat se agregar√°n aqu√≠ -->
        </main>

        <footer class="bg-gray-50 dark:bg-gray-700 p-3 sm:p-4 rounded-b-2xl border-t border-gray-200 dark:border-gray-600">
            <div id="options-container" class="flex flex-wrap gap-1 sm:gap-2 justify-center">
                <!-- Los botones de opciones se agregar√°n aqu√≠ -->
            </div>
            <div id="input-container" class="flex items-center space-x-2 hidden mt-2">
                <input type="text" id="user-input" aria-label="Escribe tu respuesta" placeholder="Escribe tu respuesta..." class="flex-1 p-2 sm:p-3 bg-gray-100 dark:bg-gray-600 rounded-full border border-gray-300 dark:border-gray-500 focus:outline-none focus:ring-2 focus:ring-red-500 text-sm sm:text-base">
                <button id="send-btn" class="bg-red-600 text-white rounded-full p-2 sm:p-3 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                </button>
            </div>
        </footer>
    </div>

    <script>
        const chatWindow = document.getElementById('chat-window');
        const optionsContainer = document.getElementById('options-container');
        const inputContainer = document.getElementById('input-container');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');

        let conversationState = 'start';
        let userData = {};
        
        const recipes = {
            'panqueques_avena': { 
                name: 'Panqueques de avena y ch√≠a', 
                prepTime: '15 min', 
                calories: '~184 kcal/porci√≥n', 
                message: `<div class="recipe-card p-3 sm:p-4 rounded-lg chat-message">
                    <p class="font-bold text-green-800 dark:text-green-200 text-sm sm:text-base">ü•û Panqueques de avena y ch√≠a</p>
                    <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-300 mt-1">‚è±Ô∏è 15 min | üî• ~184 kcal/porci√≥n</p>
                    <p class="mt-2 sm:mt-3 text-sm"><strong>Ingredientes (2 porciones):</strong></p>
                    <ul class="list-disc list-inside mt-1 text-xs sm:text-sm">
                        <li>1 taza de avena</li>
                        <li>1 cdta de ch√≠a</li>
                        <li>1 taza de leche vegetal</li>
                        <li>Endulzante a gusto</li>
                    </ul>
                    <p class="mt-2 sm:mt-3 text-sm"><strong>Preparaci√≥n:</strong></p>
                    <ol class="list-decimal list-inside mt-1 text-xs sm:text-sm">
                        <li>Licuar todos los ingredientes</li>
                        <li>Verter en sart√©n caliente con poco aceite</li>
                        <li>Cocinar por ambos lados hasta dorar</li>
                    </ol>
                </div>`
            },
            'brownie_porotos': { 
                name: 'Brownie de porotos negros', 
                prepTime: '35 min', 
                calories: '~154 kcal/porci√≥n', 
                message: `<div class="recipe-card p-3 sm:p-4 rounded-lg chat-message">
                    <p class="font-bold text-green-800 dark:text-green-200 text-sm sm:text-base">üç´ Brownie de porotos negros</p>
                    <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-300 mt-1">‚è±Ô∏è 35 min | üî• ~154 kcal/porci√≥n</p>
                    <p class="mt-2 sm:mt-3 text-sm"><strong>Ingredientes (8 porciones):</strong></p>
                    <ul class="list-disc list-inside mt-1 text-xs sm:text-sm">
                        <li>1 taza de porotos negros cocidos</li>
                        <li>2 pl√°tanos maduros</li>
                        <li>1/2 taza de cacao en polvo</li>
                        <li>1/2 taza de harina de avena</li>
                        <li>Endulzante a gusto</li>
                    </ul>
                    <p class="mt-2 sm:mt-3 text-sm"><strong>Preparaci√≥n:</strong></p>
                    <ol class="list-decimal list-inside mt-1 text-xs sm:text-sm">
                        <li>Procesar todos los ingredientes</li>
                        <li>Verter en molde aceitado</li>
                        <li>Hornear 25 min a temperatura baja</li>
                    </ol>
                </div>`
            },
            'hamburguesas_lentejas': { 
                name: 'Hamburguesas de lentejas', 
                prepTime: '30 min', 
                calories: '~170 kcal/2 unidades', 
                message: `<div class="recipe-card p-3 sm:p-4 rounded-lg chat-message">
                    <p class="font-bold text-green-800 dark:text-green-200 text-sm sm:text-base">üçî Hamburguesas de lentejas</p>
                    <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-300 mt-1">‚è±Ô∏è 30 min | üî• ~170 kcal/2 unidades</p>
                    <p class="mt-2 sm:mt-3 text-sm"><strong>Ingredientes (10 unidades):</strong></p>
                    <ul class="list-disc list-inside mt-1 text-xs sm:text-sm">
                        <li>3 tazas de lentejas cocidas</li>
                        <li>3 cdas de harina de avena</li>
                        <li>Verduras salteadas (cebolla, zanahoria)</li>
                        <li>Ali√±os a gusto</li>
                    </ul>
                    <p class="mt-2 sm:mt-3 text-sm"><strong>Preparaci√≥n:</strong></p>
                    <ol class="list-decimal list-inside mt-1 text-xs sm:text-sm">
                        <li>Mezclar los ingredientes</li>
                        <li>Formar las hamburguesas</li>
                        <li>Hornear 10 minutos por lado</li>
                    </ol>
                </div>`
            },
            'yogur_vegano': { 
                name: 'Yogur Casero Vegano', 
                prepTime: '12-15 horas', 
                calories: '~80 kcal/porci√≥n', 
                message: `<div class="recipe-card p-3 sm:p-4 rounded-lg chat-message">
                    <p class="font-bold text-green-800 dark:text-green-200 text-sm sm:text-base">ü•õ Yogur Casero Vegano</p>
                    <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-300 mt-1">‚è±Ô∏è 12-15 horas | üî• ~80 kcal/porci√≥n</p>
                    <p class="mt-2 sm:mt-3 text-sm"><strong>Ingredientes (4 porciones):</strong></p>
                    <ul class="list-disc list-inside mt-1 text-xs sm:text-sm">
                        <li>1 litro de leche de soya</li>
                        <li>2 cdas de yogur vegano comercial o c√°psulas de probi√≥ticos</li>
                        <li>1-2 cdas de az√∫car (para alimentar a las bacterias)</li>
                        <li>2 cdas de almid√≥n de ma√≠z o agar-agar (opcional, para espesar)</li>
                    </ul>
                    <p class="mt-2 sm:mt-3 text-sm"><strong>Preparaci√≥n:</strong></p>
                    <ol class="list-decimal list-inside mt-1 text-xs sm:text-sm">
                        <li>Calentar la leche a 85¬∞C por 5 minutos (pasteurizar)</li>
                        <li>Dejar enfriar hasta 45¬∞C</li>
                        <li>Agregar el cultivo iniciador y mezclar suavemente</li>
                        <li>Mantener a 45¬∞C por 8-12 horas en yogurtera, horno con luz o termo</li>
                        <li>Refrigerar 4-6 horas para que espese</li>
                    </ol>
                    <p class="mt-3 text-sm"><strong>üí° Consejo:</strong> Guarda 2 cdas de tu yogur casero para usar como cultivo iniciador en tu pr√≥ximo batch.</p>
                </div>`
            },
            'reemplazos_huevo': { 
                name: 'Reemplazos del Huevo', 
                prepTime: '5 min', 
                calories: 'Var√≠a seg√∫n opci√≥n', 
                message: `<div class="recipe-card p-3 sm:p-4 rounded-lg chat-message">
                    <p class="font-bold text-green-800 dark:text-green-200 text-sm sm:text-base">üç≥ Reemplazos del Huevo</p>
                    <p class="text-xs sm:text-sm text-gray-600 dark:text-gray-300 mt-1">‚è±Ô∏è 5 min | üî• Var√≠a seg√∫n opci√≥n</p>
                    
                    <div class="mt-3">
                        <p class="text-sm"><strong>Para aglutinar (equivale a 1 huevo):</strong></p>
                        <ul class="list-disc list-inside mt-1 ml-2 text-xs sm:text-sm">
                            <li><strong>Pur√© de pl√°tano maduro:</strong> ¬º taza (ideal para postres)</li>
                            <li><strong>Pur√© de manzana:</strong> ¬º taza (menos dulce)</li>
                            <li><strong>Semillas de ch√≠a o linaza:</strong> 1 cda + 3 cdas de agua (dejar reposar 5 min)</li>
                            <li><strong>Agar-agar:</strong> 1 cda disuelta en 1 cda de agua</li>
                        </ul>
                    </div>

                    <div class="mt-3">
                        <p class="text-sm"><strong>Para "huevo revuelto" vegano:</strong></p>
                        <ul class="list-disc list-inside mt-1 ml-2 text-xs sm:text-sm">
                            <li><strong>Tofu firme:</strong> Desmenuzar y saltear con c√∫rcuma y sal negra</li>
                            <li><strong>Garbanzos:</strong> Triturar con harina de garbanzo y especias</li>
                        </ul>
                    </div>

                    <div class="mt-3">
                        <p class="text-sm"><strong>Para espumar (merengue):</strong></p>
                        <ul class="list-disc list-inside mt-1 ml-2 text-xs sm:text-sm">
                            <li><strong>Aquafaba:</strong> L√≠quido de cocci√≥n de garbanzos (3 cdas = 1 clara)</li>
                        </ul>
                    </div>
                </div>`
            }
        };

        const conversationTree = {
            'start': {
                message: `¬°Bienvenido/a al Chat Integral de <strong>Dany el Trainer</strong>!<div class="mt-3 sm:mt-4 training-card p-3 sm:p-4 rounded-lg chat-message"><strong>üí° Mi filosof√≠a: "El movimiento es bienestar"</strong><p class="mt-2 text-xs sm:text-sm">La nutrici√≥n te da el combustible, pero el <strong>entrenamiento construye el motor.</strong> Sin movimiento, los resultados siempre ser√°n limitados.</p></div><p class="mt-3 sm:mt-4 text-sm">Elige un tema para comenzar:</p>`,
                options: [ 
                    { text: "üèãÔ∏è‚Äç‚ôÇÔ∏è Entrenamiento", nextState: 'training_intro' }, 
                    { text: "üçé Nutrici√≥n", nextState: 'nutrition_main' }, 
                    { text: "üìö Recetas", nextState: 'recipe_menu' }, 
                    { text: "üíº Servicios", nextState: 'services_info' }, 
                    { text: "üë§ Sobre M√≠", nextState: 'info_trainer' } 
                ]
            },

            // --- SECCI√ìN ENTRENAMIENTO ---
            'training_intro': {
                message: `<div class="training-card p-3 sm:p-4 rounded-lg chat-message"><strong>üèãÔ∏è‚Äç‚ôÇÔ∏è EL ENTRENAMIENTO ES LA PIEZA CLAVE</strong><p class="mt-2 text-sm">Puedes tener la mejor nutrici√≥n, pero sin un entrenamiento adecuado, nunca alcanzar√°s tu m√°ximo potencial.</p></div>`,
                options: [ 
                    { text: "üí° Consejos", nextState: 'training_tips' }, 
                    { text: "ü§∏ Estilos", nextState: 'training_styles' }, 
                    { text: "üåü Beneficios", nextState: 'training_benefits' }, 
                    { text: "üíß Hidrataci√≥n", nextState: 'hydration_info' },
                    { text: "üìö Recursos", nextState: 'practical_guides' },
                    { text: "‚Äπ Volver", nextState: 'start' } 
                ]
            },

            // --- ESTILOS DE ENTRENAMIENTO CON LINKS ---
            'training_styles': {
                 message: `<div class="training-card p-3 sm:p-4 rounded-lg chat-message">
                    <strong>ü§∏ ESTILOS DE ENTRENAMIENTO</strong>
                    <div class="mt-2 space-y-3 text-sm">
                        <div>
                            <strong>‚Ä¢ Fuerza Personalizado</strong>
                            <p>Para salud, rendimiento y reintegro deportivo</p>
                        </div>
                        <div>
                            <strong>‚Ä¢ Entrenamiento Circense</strong>
                            <p>Acrobacias, Mano a mano</p>
                        </div>
                        <div>
                            <strong>‚Ä¢ Breakdance</strong>
                            <p>Power moves, estilo y acondicionamiento</p>
                            <p class="text-xs mt-1">
                                <a href="https://youtu.be/YSXyFdY9akM" target="_blank" class="chat-link">Baby Freeze tutorial</a> | 
                                <a href="https://www.instagram.com/p/DPFuwJ9akM/" target="_blank" class="chat-link">Parada de cabeza</a>
                            </p>
                        </div>
                        <div>
                            <strong>‚Ä¢ Streetworkout</strong>
                            <p>Calistenia avanzada y fuerza relativa</p>
                            <p class="text-xs mt-1">
                                <a href="https://youtu.be/Iy2p9rwALiU" target="_blank" class="chat-link">Rutina para pararse de manos</a>
                            </p>
                        </div>
                        <div>
                            <strong>‚Ä¢ Firestaff & Malabares</strong>
                            <p>Coordinaci√≥n y habilidades √∫nicas</p>
                            <p class="text-xs mt-1">
                                <a href="https://www.instagram.com/p/DPUnAzfDUr3/" target="_blank" class="chat-link">Firestaff</a>
                            </p>
                        </div>
                    </div>
                </div>`,
                options: [ 
                    { text: "üí° Consejos", nextState: 'training_tips' }, 
                    { text: "üíº Servicios", nextState: 'services_info' }, 
                    { text: "üìû Contactar", nextState: 'contact_info' }, 
                    { text: "‚Äπ Volver", nextState: 'training_intro' } 
                ]
            },

            // --- CONSEJOS DE ENTRENAMIENTO ACTUALIZADOS ---
            'training_tips': {
                message: `<div class="training-card p-3 sm:p-4 rounded-lg chat-message">
                    <strong>üí° CONSEJOS DE ENTRENAMIENTO</strong>
                    <div class="mt-2 p-2 sm:p-3 bg-yellow-100 dark:bg-yellow-800 rounded text-xs sm:text-sm">
                        <strong>‚ö†Ô∏è NOTA IMPORTANTE:</strong> Estas son indicaciones generales que pueden y deben ser ajustadas seg√∫n cada caso particular por una persona competente. <strong>¬øConversamos para una asesor√≠a personalizada?</strong>
                    </div>
                    
                    <div class="mt-3">
                        <p class="font-semibold text-sm sm:text-base">üèóÔ∏è LA PIR√ÅMIDE DEL ENTRENAMIENTO F√çSICO:</p>
                        <div class="mt-2 space-y-2">
                            <div class="bg-red-100 dark:bg-red-800 p-2 sm:p-3 rounded text-xs sm:text-sm">
                                <strong>BASE: Movimiento Fundamental</strong>
                                <p class="mt-1">Dominar los patrones b√°sicos de movimiento antes de avanzar a ejercicios complejos.</p>
                            </div>
                            <div class="bg-orange-100 dark:bg-orange-800 p-2 sm:p-3 rounded text-xs sm:text-sm">
                                <strong>NIVEL 2: Capacidad de Trabajo</strong>
                                <p class="mt-1">Desarrollar resistencia, fuerza base y capacidad de recuperaci√≥n.</p>
                            </div>
                            <div class="bg-yellow-100 dark:bg-yellow-800 p-2 sm:p-3 rounded text-xs sm:text-sm">
                                <strong>NIVEL 3: Habilidades Espec√≠ficas</strong>
                                <p class="mt-1">Entrenamiento especializado seg√∫n tu deporte o actividad.</p>
                            </div>
                            <div class="bg-green-100 dark:bg-green-800 p-2 sm:p-3 rounded text-xs sm:text-sm">
                                <strong>C√öSPIDE: Competencia, Shows y Performance</strong>
                                <p class="mt-1">Optimizaci√≥n del rendimiento para competici√≥n, presentaciones art√≠sticas o objetivos espec√≠ficos de alto nivel.</p>
                            </div>
                        </div>
                    </div>

                    <div class="mt-3">
                        <p class="font-semibold text-sm sm:text-base">‚ö° INTENSIDAD vs ESFUERZO PERCIBIDO:</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mt-2">
                            <div class="bg-blue-100 dark:bg-blue-800 p-2 sm:p-3 rounded text-xs sm:text-sm">
                                <strong>Intensidad (Objetiva)</strong>
                                <ul class="list-disc list-inside mt-1">
                                    <li><strong>% de 1RM:</strong> Porcentaje de tu repetici√≥n m√°xima</li>
                                    <li><strong>Velocidad de ejecuci√≥n:</strong> Control del tempo (ej: 3-1-2 segundos)</li>
                                    <li><strong>RIR (Reps en Reserva):</strong> Cu√°ntas repeticiones te faltan para el fallo</li>
                                </ul>
                            </div>
                            <div class="bg-purple-100 dark:bg-purple-800 p-2 sm:p-3 rounded text-xs sm:text-sm">
                                <strong>Esfuerzo (Subjetivo)</strong>
                                <ul class="list-disc list-inside mt-1">
                                    <li><strong>RPE (Esfuerzo Percibido):</strong> Escala 1-10 de dificultad</li>
                                    <li><strong>Fatiga local-perif√©rica:</strong> Cansancio muscular espec√≠fico</li>
                                    <li><strong>Fatiga central:</strong> Cansancio del sistema nervioso</li>
                                </ul>
                            </div>
                        </div>
                        <p class="mt-2 text-xs sm:text-sm"><strong>üí° Pr√°ctica:</strong> La fatiga acumulada es la inmediata de la sesi√≥n; la residual perdura y requiere m√°s recuperaci√≥n. Ambas deben gestionarse estrat√©gicamente.</p>
                    </div>

                    <div class="mt-3">
                        <p class="font-semibold text-sm sm:text-base">üî¨ DESMINTIENDO MITOS: MENTE-M√öSCULO vs BIOMEC√ÅNICA</p>
                        <ul class="list-disc list-inside mt-2 space-y-1 text-xs sm:text-sm">
                            <li><strong>Lo realmente importante es la BIOMEC√ÅNICA:</strong> La correcta alineaci√≥n articular, palancas y brazos de momento determinan la eficiencia del movimiento.</li>
                            <li><strong>La tensi√≥n mec√°nica es clave:</strong> No confundas la sensaci√≥n de "ardor" local con tensi√≥n mec√°nica efectiva. Esta √∫ltima se siente como una presi√≥n profunda en los m√∫sculos y tejidos conectivos.</li>
                            <li><strong>RPE 8-10 = Tensi√≥n mec√°nica alta:</strong> Cuando trabajas cerca del fallo (RIR 0-2), produces m√°xima tensi√≥n mec√°nica, el est√≠mulo principal para la hipertrofia.</li>
                        </ul>
                    </div>

                    <div class="mt-3">
                        <p class="font-semibold text-sm sm:text-base">üìâ INTENSIDADES BAJAS vs ADAPTACIONES (‚â§60% 1RM):</p>
                        <ul class="list-disc list-inside mt-2 space-y-1 text-xs sm:text-sm">
                            <li><strong>Objetivos espec√≠ficos:</strong>
                                <ul class="list-circle list-inside ml-3 mt-1">
                                    <li>Recuperaci√≥n activa y reintegro deportivo</li>
                                    <li>Exploraci√≥n de patrones motores y rangos no recorridos</li>
                                    <li>Poblaciones con limitaciones de salud</li>
                                    <li>Periodos de adaptaci√≥n inicial o transici√≥n</li>
                                </ul>
                            </li>
                            <li><strong>Combinaci√≥n estrat√©gica:</strong> Puedes usar intensidades bajas con esfuerzos altos mediante:
                                <ul class="list-circle list-inside ml-3 mt-1">
                                    <li>Series de alta repetici√≥n (20-30 reps)</li>
                                    <li>Tiempos bajo tensi√≥n prolongados</li>
                                    <li>Circuitos con pausas m√≠nimas</li>
                                    <li>T√©cnicas de intensificaci√≥n (rest-pause, dropsets)</li>
                                </ul>
                            </li>
                            <li><strong>Limitaciones:</strong> Producen adaptaciones limitadas si no se combinan con otros factores de sobrecarga.</li>
                        </ul>
                    </div>

                    <div class="mt-3">
                        <p class="font-semibold text-sm sm:text-base">üìà INTENSIDADES ALTAS vs ADAPTACIONES (‚â•70% 1RM):</p>
                        <ul class="list-disc list-inside mt-2 space-y-1 text-xs sm:text-sm">
                            <li><strong>Objetivos amplios y profundos:</strong>
                                <ul class="list-circle list-inside ml-3 mt-1">
                                    <li>Mejora de la salud general y mantenci√≥n de condici√≥n f√≠sica</li>
                                    <li>Desarrollo atl√©tico, art√≠stico y deportivo</li>
                                    <li>Incremento de fuerza, resistencia y resiliencia</li>
                                    <li>Optimizaci√≥n metab√≥lica y fortalecimiento tisular</li>
                                    <li>Fortalecimiento de redes neuronales y capacidades cognitivas</li>
                                </ul>
                            </li>
                            <li><strong>Beneficios integrales:</strong> Las intensidades altas activan adaptaciones que optimizan todo el sistema neuromuscular y metab√≥lico.</li>
                            <li><strong>Potencial de aplicaci√≥n:</strong> Mejoran la transferencia a actividades de la vida diaria y desempe√±o espec√≠fico.</li>
                        </ul>
                    </div>

                    <div class="mt-3">
                        <p class="font-semibold text-sm sm:text-base">üìà TIPS PARA PROGRESAR EN CUALQUIER ACTIVIDAD:</p>
                        <ol class="list-decimal list-inside mt-2 space-y-1 text-xs sm:text-sm">
                            <li><strong>Elige un ejercicio significativo:</strong> Que represente un esfuerzo RPE 7-8 con tu peso corporal o carga adicional.</li>
                            <li><strong>Trabaja con RIR 3-4:</strong> Mantente a 3-4 repeticiones del fallo muscular, en un rango de 10-15 repeticiones.</li>
                            <li><strong>Respeta tiempos de recuperaci√≥n:</strong> Descansos entre series de 2-3 minutos para ejercicios multiarticulares.</li>
                            <li><strong>Progresa cuando notes facilidad:</strong> <strong>NO en la misma sesi√≥n</strong>, sino despu√©s de un par de semanas (var√≠a seg√∫n la persona). Los indicadores de "facilidad" son:
                                <ul class="list-disc list-inside ml-3 mt-1">
                                    <li><strong>Velocidad de ejecuci√≥n:</strong> Mueves la carga m√°s r√°pido con la misma t√©cnica</li>
                                    <li><strong>Menor esfuerzo percibido:</strong> Cada repetici√≥n se siente m√°s f√°cil</li>
                                    <li><strong>Sobrepasas el rango de reps:</strong> Puedes hacer m√°s repeticiones de las propuestas</li>
                                    <li><strong>Mantienes calidad t√©cnica:</strong> La t√©cnica se mantiene o mejora a lo largo de las series</li>
                                    <li><strong>Recuperaci√≥n m√°s r√°pida:</strong> Te recuperas m√°s pronto entre series</li>
                                </ul>
                            </li>
                            <li><strong>REGISTRA TODO:</strong> Tu diario de entrenamiento es tu llave maestra para el progreso constante.</li>
                            <li><strong>Semanas de ajuste:</strong> Peri√≥dicamente (cada 4-8 semanas), dedica una semana a probar cargas diferentes para evaluar tu progreso real.</li>
                        </ol>
                    </div>

                    <div class="mt-3 p-2 sm:p-3 bg-blue-100 dark:bg-blue-800 rounded text-xs sm:text-sm">
                        <p><strong>üéØ Mi enfoque:</strong> Dise√±o programas que respetan esta pir√°mide, comenzando con una base s√≥lida de movimiento y progresando hacia objetivos espec√≠ficos, aplicando los principios de especificidad, sobrecarga progresiva y tensi√≥n mec√°nica efectiva.</p>
                    </div>
                </div>`,
                options: [ 
                    { text: "üí¨ Asesor√≠a Personal", nextState: 'contact_info' }, 
                    { text: "üíº Servicios", nextState: 'services_info' }, 
                    { text: "‚Äπ Volver", nextState: 'training_intro' } 
                ]
            },

            // --- SECCI√ìN NUTRICI√ìN COMPLETA ---
            'nutrition_main': {
                message: `<div class="info-card p-3 sm:p-4 rounded-lg chat-message">
                    <p class="font-bold text-blue-800 dark:text-blue-200 text-sm sm:text-base">üçé EDUCACI√ìN NUTRICIONAL</p>
                    <p class="mt-2 text-sm">La nutrici√≥n es el combustible, pero necesita del entrenamiento para construir resultados reales.</p>
                </div>`,
                options: [ 
                    { text: "üìä Calcular Macros", nextState: 'ask_gender' }, 
                    { text: "üèóÔ∏è Pir√°mide Nutricional", nextState: 'learn_pyramid_intro' }, 
                    { text: "üíß Hidrataci√≥n", nextState: 'hydration_info' },
                    { text: "üìö Recursos", nextState: 'practical_guides' },
                    { text: "‚Äπ Volver", nextState: 'start' } 
                ]
            },

            // --- PIR√ÅMIDE NUTRICIONAL COMPLETA ---
            'learn_pyramid_intro': {
                message: `<div class="info-card p-3 sm:p-4 rounded-lg chat-message">
                    <p class="font-bold text-blue-800 dark:text-blue-200 text-sm sm:text-base">üçé EDUCACI√ìN NUTRICIONAL</p>
                    <p class="mt-2 text-sm">¬°Excelente! Usaremos La Pir√°mide de la Nutrici√≥n para aprender en orden de importancia.</p>
                    <p class="mt-2 text-sm"><strong>Primero, definamos conceptos clave:</strong></p>
                    <ul class="list-disc list-inside mt-1 text-sm">
                        <li><strong>Nutrici√≥n:</strong> Proceso biol√≥gico de obtenci√≥n de nutrientes</li>
                        <li><strong>Alimentaci√≥n:</strong> Acto consciente de ingerir alimentos</li>
                        <li><strong>Dieta:</strong> Conjunto de alimentos que consumes habitualmente</li>
                        <li><strong>R√©gimen alimenticio:</strong> Plan estructurado con objetivos espec√≠ficos</li>
                    </ul>
                    <p class="mt-2 text-sm">¬øListo para conocer el Nivel 1, la base de todo?</p>
                </div>`,
                options: [ { text: "S√≠, vamos al Nivel 1", nextState: 'learn_pyramid_level1' }, { text: "‚Äπ Volver", nextState: 'nutrition_main' } ]
            },
            'learn_pyramid_level1': {
                message: `<div class="info-card p-3 sm:p-4 rounded-lg chat-message">
                    <p class="font-bold text-blue-800 dark:text-blue-200 text-sm sm:text-base">NIVEL 1: BALANCE ENERG√âTICO</p>
                    <p class="mt-2 text-sm">Esto es lo m√°s importante: las calor√≠as que consumes vs. las que gastas.</p>
                    <ul class="list-disc list-inside mt-1 text-sm">
                        <li>Para perder grasa, necesitas un <strong>d√©ficit cal√≥rico</strong> (comer menos de lo que gastas).</li>
                        <li>Para ganar m√∫sculo, necesitas un <strong>super√°vit cal√≥rico</strong> (comer m√°s de lo que gastas).</li>
                    </ul>
                    <p class="mt-2 text-sm">Sin esto, nada m√°s funciona. ¬øContinuamos al Nivel 2?</p>
                </div>`,
                options: [ { text: "S√≠, al Nivel 2", nextState: 'learn_pyramid_level2' } ]
            },
            'learn_pyramid_level2': {
                message: `<div class="info-card p-3 sm:p-4 rounded-lg chat-message">
                    <p class="font-bold text-blue-800 dark:text-blue-200 text-sm sm:text-base">NIVEL 2: MACRONUTRIENTES</p>
                    <p class="mt-2 text-sm">Una vez que tienes tus calor√≠as, las distribuyes en los 'macros': Prote√≠nas, Carbohidratos y Grasas. La cantidad de cada uno es clave para la composici√≥n corporal.</p>
                    <p class="mt-2 text-sm"><strong>¬øQu√© son los macronutrientes?</strong></p>
                    <ul class="list-disc list-inside mt-1 text-sm">
                        <li><strong>Prote√≠nas:</strong> Construyen y reparan tejidos (4 kcal/g)</li>
                        <li><strong>Carbohidratos:</strong> Energ√≠a principal (4 kcal/g)</li>
                        <li><strong>Grasas:</strong> Energ√≠a de reserva y funciones vitales (9 kcal/g)</li>
                    </ul>
                    <p class="mt-2 text-sm">¬øQuieres ver una tabla con fuentes comunes de cada macro?</p>
                </div>`,
                options: [ { text: "S√≠, mostrar tabla", nextState: 'learn_pyramid_sources' }, { text: "No, ir al Nivel 3", nextState: 'learn_pyramid_level3' } ]
            },
            'learn_pyramid_sources': {
                message: `<div class="info-card p-3 sm:p-4 rounded-lg chat-message">
                    <p class="font-bold text-blue-800 dark:text-blue-200 text-sm sm:text-base">FUENTES DE MACRONUTRIENTES</p>
                    <table class="styled-table mt-3">
                        <thead><tr><th>Prote√≠nas</th><th>Carbohidratos</th><th>Grasas</th></tr></thead>
                        <tbody>
                            <tr><td>Pollo, Pescado, Huevos</td><td>Arroz, Papas, Avena</td><td>Palta, Aceite de Oliva</td></tr>
                            <tr><td>Carne, Cerdo, Lentejas</td><td>Pan, Fideos, Frutas</td><td>Frutos secos, Semillas</td></tr>
                            <tr><td>Tofu, Yogurt Griego</td><td>Quinoa, Camote, Choclo</td><td>Pescados grasos (Salm√≥n)</td></tr>
                        </tbody>
                    </table>
                    <p class="mt-3 text-sm">¬øContinuamos al siguiente nivel?</p>
                </div>`,
                options: [{ text: "S√≠, vamos al Nivel 3", nextState: 'learn_pyramid_level3' }]
            },
            'learn_pyramid_level3': {
                message: `<div class="info-card p-3 sm:p-4 rounded-lg chat-message">
                    <p class="font-bold text-blue-800 dark:text-blue-200 text-sm sm:text-base">NIVEL 3: MICRONUTRIENTES</p>
                    <p class="mt-2 text-sm">Son las vitaminas y minerales. <strong>AMBOS son igualmente importantes:</strong></p>
                    <ul class="list-disc list-inside mt-1 text-sm">
                        <li><strong>Vitaminas:</strong> A, B, C, D, E, K - esenciales para funciones metab√≥licas</li>
                        <li><strong>Minerales:</strong> Calcio, Hierro, Zinc, Magnesio - estructura y regulaci√≥n</li>
                    </ul>
                    <p class="mt-2 text-sm"><strong>‚ö†Ô∏è IMPORTANTE:</strong> El d√©ficit de micronutrientes lleva a enfermedades graves como anemia (hierro), escorbuto (vitamina C), raquitismo (vitamina D).</p>
                    <p class="mt-2 text-sm">Si tu dieta se basa en alimentos poco procesados y tienes una buena variedad de frutas y verduras, es muy probable que est√©s cubriendo tus necesidades.</p>
                    <p class="mt-2 text-sm">¬øListo para el Nivel 4?</p>
                </div>`,
                options: [ { text: "S√≠, al Nivel 4", nextState: 'learn_pyramid_level4' } ]
            },
            'learn_pyramid_level4': {
                message: `<div class="info-card p-3 sm:p-4 rounded-lg chat-message">
                    <p class="font-bold text-blue-800 dark:text-blue-200 text-sm sm:text-base">NIVEL 4: TIMING Y FRECUENCIA</p>
                    <p class="mt-2 text-sm">Aqu√≠ hablamos de cu√°ntas veces comer al d√≠a y cu√°ndo consumir tus nutrientes (ej: pre/post entreno).</p>
                    <p class="mt-2 text-sm">Esto tiene un impacto menor. Lo m√°s importante es que cumplas tus calor√≠as y macros totales del d√≠a de una forma que se te haga c√≥moda y sostenible (adherencia).</p>
                    <p class="mt-2 text-sm">¬øVamos a la punta de la pir√°mide?</p>
                </div>`,
                options: [ { text: "S√≠, al Nivel 5", nextState: 'learn_pyramid_level5' } ]
            },
            'learn_pyramid_level5': {
                message: `<div class="info-card p-3 sm:p-4 rounded-lg chat-message">
                    <p class="font-bold text-blue-800 dark:text-blue-200 text-sm sm:text-base">NIVEL 5: SUPLEMENTOS (La Punta)</p>
                    <p class="mt-2 text-sm">Son la parte menos importante. Solo tienen sentido cuando los 4 niveles inferiores ya est√°n optimizados.</p>
                    <p class="mt-2 text-sm">Suplementos como la prote√≠na en polvo o la creatina pueden ser √∫tiles, pero no son m√°gicos. Son solo una peque√±a ayuda.</p>
                </div>`,
                options: [ { text: "Saber m√°s de suplementos", nextState: 'info_suplementos' }, { text: "¬°Entendido!", nextState: 'nutrition_main' } ]
            },

            // --- C√ÅLCULO DE MACROS COMPLETO ---
            'ask_gender': { 
                message: "Para calcular tus macros, necesito algunos datos. ¬øCu√°l es tu g√©nero?", 
                options: [ 
                    { text: "Hombre", value: 'male', nextState: 'ask_age' }, 
                    { text: "Mujer", value: 'female', nextState: 'ask_age' } 
                ], 
                action: (value) => { userData.gender = value; } 
            },
            'ask_age': { 
                message: "Introduce tu edad en a√±os (entre 15 y 100):", 
                inputType: 'number',
                nextState: 'ask_weight',
                validate: (value) => {
                    const age = parseInt(value);
                    if (isNaN(age) || age < 15 || age > 100) {
                        return "Por favor, introduce una edad v√°lida entre 15 y 100 a√±os.";
                    }
                    userData.age = age;
                    return null;
                }
            },
            'ask_weight': { 
                message: "¬øTu peso en kilogramos? (entre 30 y 300 kg):", 
                inputType: 'number',
                nextState: 'ask_height',
                validate: (value) => {
                    const weight = parseFloat(value);
                    if (isNaN(weight) || weight < 30 || weight > 300) {
                        return "Por favor, introduce un peso v√°lido entre 30 y 300 kg.";
                    }
                    userData.weight = weight;
                    return null;
                }
            },
            'ask_height': { 
                message: "¬øTu altura en cent√≠metros? (entre 100 y 250 cm):", 
                inputType: 'number',
                nextState: 'ask_activity_level',
                validate: (value) => {
                    const height = parseInt(value);
                    if (isNaN(height) || height < 100 || height > 250) {
                        return "Por favor, introduce una altura v√°lida entre 100 y 250 cm.";
                    }
                    userData.height = height;
                    return null;
                }
            },
            'ask_activity_level': { 
                message: "Finalmente, elige tu nivel de actividad semanal:", 
                options: [ 
                    { text: "Sedentario (poco o nada de ejercicio)", value: 1.2, nextState: 'macro_results' }, 
                    { text: "Actividad Ligera (ejercicio 1-3 d√≠as/semana)", value: 1.375, nextState: 'macro_results' }, 
                    { text: "Actividad Moderada (ejercicio 3-5 d√≠as/semana)", value: 1.55, nextState: 'macro_results' }, 
                    { text: "Actividad Intensa (ejercicio 6-7 d√≠as/semana)", value: 1.725, nextState: 'macro_results' }, 
                    { text: "Atleta/√âlite (ejercicio 2 veces/d√≠a)", value: 1.9, nextState: 'macro_results' } 
                ], 
                action: (value) => { userData.activityMultiplier = parseFloat(value); } 
            },
            'macro_results': {
                getMessage: (data) => {
                    // C√°lculo de TMB (Tasa Metab√≥lica Basal) usando la ecuaci√≥n de Mifflin-St Jeor
                    let bmr;
                    if (data.gender === 'male') {
                        bmr = 10 * data.weight + 6.25 * data.height - 5 * data.age + 5;
                    } else {
                        bmr = 10 * data.weight + 6.25 * data.height - 5 * data.age - 161;
                    }
                    
                    // C√°lculo del TDEE (Gasto Energ√©tico Total Diario)
                    const tdee = Math.round(bmr * data.activityMultiplier);
                    
                    // Funci√≥n para calcular macros
                    const calculateMacros = (calories, weight) => {
                        const proteinGrams = Math.max(Math.round(weight * 1.8), 50);
                        const proteinCalories = proteinGrams * 4;
                        
                        const fatGrams = Math.max(Math.round((calories * 0.25) / 9), 30);
                        const fatCalories = fatGrams * 9;
                        
                        const remainingCalories = calories - proteinCalories - fatCalories;
                        const carbGrams = Math.max(Math.round(remainingCalories / 4), 50);
                        
                        return { 
                            calories: Math.round(calories), 
                            proteinGrams, 
                            fatGrams, 
                            carbGrams 
                        };
                    };
                    
                    // C√°lculos para diferentes objetivos
                    const fatLoss = calculateMacros(tdee - 400, data.weight);
                    const maintenance = calculateMacros(tdee, data.weight);
                    const hypertrophy = calculateMacros(tdee + 400, data.weight);
                    
                    let resultHTML = `<div class="info-card p-3 sm:p-4 rounded-lg chat-message">
                        <p class="font-bold text-blue-800 dark:text-blue-200 text-sm sm:text-base">üìä RESULTADOS DE TUS MACROS</p>
                        <p class="mt-2 text-sm">Basado en tus datos, tu gasto energ√©tico diario es aproximadamente <strong>${tdee} kcal</strong>.</p>
                        <p class="mt-2 text-sm">Aqu√≠ tienes tus macros para diferentes objetivos:</p>
                        <table class="styled-table mt-3">
                            <thead>
                                <tr>
                                    <th>Objetivo</th>
                                    <th>Calor√≠as</th>
                                    <th>Prote√≠nas</th>
                                    <th>Grasas</th>
                                    <th>Carbs</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>üìâ Reducir Grasa</td>
                                    <td>${fatLoss.calories}</td>
                                    <td>${fatLoss.proteinGrams}g</td>
                                    <td>${fatLoss.fatGrams}g</td>
                                    <td>${fatLoss.carbGrams}g</td>
                                </tr>
                                <tr>
                                    <td>‚öñÔ∏è Mantenimiento</td>
                                    <td>${maintenance.calories}</td>
                                    <td>${maintenance.proteinGrams}g</td>
                                    <td>${maintenance.fatGrams}g</td>
                                    <td>${maintenance.carbGrams}g</td>
                                </tr>
                                <tr>
                                    <td>üí™ Ganar M√∫sculo</td>
                                    <td>${hypertrophy.calories}</td>
                                    <td>${hypertrophy.proteinGrams}g</td>
                                    <td>${hypertrophy.fatGrams}g</td>
                                    <td>${hypertrophy.carbGrams}g</td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="mt-4 training-card p-3 rounded text-sm">
                            <strong>‚ö†Ô∏è IMPORTANTE:</strong> Estos n√∫meros son una gu√≠a inicial. Para mejores resultados, combina esta nutrici√≥n con un programa de entrenamiento adecuado.
                        </div>
                    </div>`;
                    return resultHTML;
                },
                options: [ 
                    { text: "üèãÔ∏è‚Äç‚ôÇÔ∏è Plan de entrenamiento", nextState: 'services_info' }, 
                    { text: "üí° Consejos de entrenamiento", nextState: 'training_tips' }, 
                    { text: "üçΩÔ∏è Ver recetas", nextState: 'recipe_menu' }, 
                    { text: "üîÑ Calcular de nuevo", nextState: 'ask_gender' }, 
                    { text: "‚Äπ Volver", nextState: 'nutrition_main' } 
                ]
            },

            // --- RECURSOS PR√ÅCTICOS COMPLETOS CON LINK DE DRIVE ---
            'practical_guides': { 
                message: `<div class="guide-card p-3 sm:p-4 rounded-lg chat-message">
                    <strong>üìö RECURSOS PR√ÅCTICOS</strong>
                    <p class="mt-2 text-sm">Gu√≠as basadas en documentos especializados para ayudarte en tu d√≠a a d√≠a.</p>
                    <div class="mt-3 p-3 bg-green-100 dark:bg-green-800 rounded">
                        <p class="text-sm font-bold">üéÅ ¬°Material de Regalo!</p>
                        <p class="text-xs mt-1">Descarga toda la informaci√≥n completa en:</p>
                        <a href="https://drive.google.com/drive/folders/tu-link-aqui" target="_blank" class="chat-link text-sm font-bold">üì• Drive - Material Completo Dany el Trainer</a>
                    </div>
                </div>`, 
                options: [ 
                    { text: "ü•ö Reemplazos Huevo", nextState: 'guide_huevo' }, 
                    { text: "ü•õ Yogur Vegano", nextState: 'guide_yogur' }, 
                    { text: "üì¶ Meal Prep", nextState: 'meal_prep_intro' }, 
                    { text: "üìÖ Planificador", nextState: 'guide_planner' },
                    { text: "üíß Hidrataci√≥n", nextState: 'hydration_info' },
                    { text: "üçΩÔ∏è M√°s Recetas", nextState: 'recipe_menu' },
                    { text: "‚Äπ Volver", nextState: 'start' } 
                ] 
            },

            'guide_huevo': { 
                message: `<div class="guide-card p-3 sm:p-4 rounded-lg chat-message">
                    <strong>ü•ö REEMPLAZOS DEL HUEVO</strong>
                    <ul class="list-disc list-inside mt-2 space-y-1 text-sm">
                        <li><strong>Para aglutinar:</strong> Pur√© de pl√°tano, manzana, o ch√≠a/linaza + agua</li>
                        <li><strong>Para "huevo revuelto":</strong> Tofu desmenuzado con c√∫rcuma y sal negra</li>
                        <li><strong>Para espumar:</strong> Aquafaba (agua de garbanzos)</li>
                    </ul>
                    <div class="mt-3 p-2 bg-yellow-100 dark:bg-yellow-800 rounded text-xs">
                        <strong>üí° Material Completo:</strong> <a href="https://drive.google.com/drive/folders/tu-link-aqui" target="_blank" class="chat-link">Descargar gu√≠a completa en Drive</a>
                    </div>
                </div>`, 
                options: [ 
                    { text: "‚Äπ Volver", nextState: 'practical_guides' }
                ] 
            },

            'guide_yogur': { 
                message: `<div class="guide-card p-3 sm:p-4 rounded-lg chat-message">
                    <strong>ü•õ YOGUR CASERO VEGANO</strong>
                    <ul class="list-disc list-inside mt-2 space-y-1 text-sm">
                        <li>Usa leche de soya con alto contenido de s√≥lidos o a√±ade un espesante como agar-agar</li>
                        <li>Necesitas un cultivo iniciador (probi√≥ticos) y un poco de az√∫car para la fermentaci√≥n</li>
                        <li>Mant√©n la mezcla a 45¬∞C por 12-15 horas en yogurtera o termo</li>
                    </ul>
                    <div class="mt-3 p-2 bg-yellow-100 dark:bg-yellow-800 rounded text-xs">
                        <strong>üí° Material Completo:</strong> <a href="https://drive.google.com/drive/folders/tu-link-aqui" target="_blank" class="chat-link">Descargar gu√≠a completa en Drive</a>
                    </div>
                </div>`, 
                options: [ 
                    { text: "‚Äπ Volver", nextState: 'practical_guides' }
                ] 
            },

            'meal_prep_intro': { 
                message: `<div class="guide-card p-3 sm:p-4 rounded-lg chat-message">
                    <strong>üì¶ MEAL PREP PLANT BASED</strong>
                    <p class="mt-2 text-sm">Planificar y preparar tus comidas con antelaci√≥n es clave para una alimentaci√≥n consistente.</p>
                    <p class="mt-2 text-sm"><strong>Beneficios:</strong></p>
                    <ul class="list-disc list-inside mt-1 text-sm">
                        <li>Ahorrar tiempo y dinero</li>
                        <li>Mantener el control sobre nutrientes</li>
                        <li>Evitar decisiones impulsivas</li>
                    </ul>
                    <div class="mt-3 p-2 bg-yellow-100 dark:bg-yellow-800 rounded text-xs">
                        <strong>üí° Material Completo:</strong> <a href="https://drive.google.com/drive/folders/tu-link-aqui" target="_blank" class="chat-link">Descargar gu√≠a completa en Drive</a>
                    </div>
                </div>`, 
                options: [ 
                    { text: "‚Äπ Volver", nextState: 'practical_guides' }
                ] 
            },

            'guide_planner': { 
                message: `<div class="guide-card p-3 sm:p-4 rounded-lg chat-message">
                    <strong>üìÖ PLANIFICADOR SEMANAL</strong>
                    <p class="mt-2 text-sm">Una buena planificaci√≥n es clave para el √©xito.</p>
                    <p class="mt-2 text-sm"><strong>Recomendaciones:</strong></p>
                    <ul class="list-disc list-inside mt-1 text-sm">
                        <li>Usa un planificador semanal para organizar comidas</li>
                        <li>Crea lista de compras basada en tu plan</li>
                        <li>Prepara ingredientes base los domingos</li>
                    </ul>
                    <div class="mt-3 p-2 bg-yellow-100 dark:bg-yellow-800 rounded text-xs">
                        <strong>üí° Material Completo:</strong> <a href="https://drive.google.com/drive/folders/tu-link-aqui" target="_blank" class="chat-link">Descargar gu√≠a completa en Drive</a>
                    </div>
                </div>`, 
                options: [ 
                    { text: "‚Äπ Volver", nextState: 'practical_guides' }
                ] 
            },

            // --- SERVICIOS ---
            'services_info': {
                message: `<div class="training-card p-3 sm:p-4 rounded-lg chat-message">
                    <strong>üíº MIS SERVICIOS</strong>
                    <div class="mt-2 space-y-2 text-sm">
                        <div>
                            <strong>‚Ä¢ Entrenamiento Personalizado</strong>
                            <p>Online o presencial, planificaci√≥n individualizada</p>
                        </div>
                        <div>
                            <strong>‚Ä¢ Clases Grupales</strong>
                            <p>Streetworkout, Breakdance y Acrobacias</p>
                        </div>
                        <div>
                            <strong>‚Ä¢ Workshops</strong>
                            <p>Eventos para habilidades espec√≠ficas</p>
                        </div>
                        <div>
                            <strong>‚Ä¢ Asesor√≠as Integrales</strong>
                            <p>Movimiento, ocupacional y nutrici√≥n</p>
                        </div>
                    </div>
                </div>`,
                options: [ 
                    { text: "üìû Contactar", nextState: 'contact_info' }, 
                    { text: "üí° Consejos", nextState: 'training_tips' }, 
                    { text: "‚Äπ Volver", nextState: 'start' } 
                ]
            },

            'contact_info': {
                message: `<div class="bg-gradient-to-r from-red-500 to-orange-500 text-white p-3 sm:p-4 rounded-lg chat-message"><strong>üöÄ ¬°ALCANCE SU MEJOR VERSI√ìN!</strong><p class="mt-2 text-sm">Cont√°ctame y empecemos a construir tu camino.</p><div class="mt-2 space-y-1 text-sm"><p><strong>üì± WhatsApp:</strong> <a href="https://wa.me/56935541341" target="_blank" class="underline font-bold">+56 9 3554 1341</a></p><p><strong>üì∏ Instagram:</strong> <a href="https://instagram.com/dany.el.trainer" target="_blank" class="underline font-bold">@dany.el.trainer</a></p></div></div>`,
                options: [ 
                    { text: "‚Äπ Volver", nextState: 'start' } 
                ]
            },

            'info_trainer': { 
                message: `<div class="info-card p-3 sm:p-4 rounded-lg chat-message">
                    <p class="font-bold text-blue-800 dark:text-blue-200 text-sm sm:text-base">üë§ DANY EL TRAINER</p>
                    <div class="mt-2 space-y-1 text-sm">
                        <p><strong>üéì Formaci√≥n:</strong> T√©cnico Superior en Preparaci√≥n F√≠sica</p>
                        <p><strong>üé≠ Especialidades:</strong> Entrenamiento funcional, calistenia, artes circenses</p>
                        <p><strong>üí° Filosof√≠a:</strong> "El movimiento es bienestar"</p>
                    </div>
                </div>`, 
                options: [ { text: "üíº Servicios", nextState: 'services_info' }, { text: "‚Äπ Volver", nextState: 'start' } ] 
            },

            // --- RECETAS COMPLETAS ---
            'recipe_menu': {
                message: `<div class="recipe-card p-3 sm:p-4 rounded-lg chat-message">
                    <p class="font-bold text-green-800 dark:text-green-200 text-sm sm:text-base">üçΩÔ∏è RECETAS SALUDABLES</p>
                    <p class="mt-2 text-sm">Elige una receta para ver los detalles:</p>
                </div>`,
                options: [
                    { text: "ü•û Panqueques Avena", value: 'panqueques_avena', nextState: 'show_recipe' },
                    { text: "üç´ Brownie Porotos", value: 'brownie_porotos', nextState: 'show_recipe' },
                    { text: "üçî Hamburguesas Lentejas", value: 'hamburguesas_lentejas', nextState: 'show_recipe' },
                    { text: "ü•õ Yogur Vegano", value: 'yogur_vegano', nextState: 'show_recipe' },
                    { text: "üç≥ Reemplazos Huevo", value: 'reemplazos_huevo', nextState: 'show_recipe' },
                    { text: "‚Äπ Volver", nextState: 'start' }
                ],
                action: (value) => { userData.recipe = value; }
            },

            'show_recipe': {
                getMessage: (data) => recipes[data.recipe].message,
                options: [ 
                    { text: "üçΩÔ∏è Otra Receta", nextState: 'recipe_menu' }, 
                    { text: "‚Äπ Volver", nextState: 'start' } 
                ]
            },

            // --- HIDRATACI√ìN ---
            'hydration_info': { 
                message: `<div class="info-card p-3 sm:p-4 rounded-lg chat-message">
                    <strong>üíß HIDRATACI√ìN</strong>
                    <p class="mt-2 text-sm">Fundamental para el rendimiento y la salud.</p>
                    <p class="mt-1 text-sm"><strong>Recomendaci√≥n:</strong> 2 a 3 litros de agua al d√≠a.</p>
                </div>`, 
                options: [ 
                    { text: "üíß Calcular", nextState: 'hydration_ask_activity' }, 
                    { text: "‚Äπ Volver", nextState: 'start' } 
                ] 
            },

            'hydration_ask_activity': { 
                message: "¬øC√≥mo describir√≠as tu actividad f√≠sica?", 
                options: [ 
                    { text: "üèÉ‚Äç‚ôÇÔ∏è Alta (Entreno intenso diario)", value: 'alta', nextState: 'hydration_calculate' }, 
                    { text: "üö∂‚Äç‚ôÄÔ∏è Moderada (3-4 veces/semana)", value: 'moderada', nextState: 'hydration_calculate' }, 
                    { text: "üíª Baja (Sedentario/oficina)", value: 'baja', nextState: 'hydration_calculate' } 
                ], 
                action: (value) => { userData.activityLevel = value; } 
            },

            'hydration_calculate': {
                getMessage: (data) => {
                    const baseWater = 2000; // ml base
                    let additionalWater = 0;
                    
                    switch(data.activityLevel) {
                        case 'alta': additionalWater = 1000; break;
                        case 'moderada': additionalWater = 500; break;
                        case 'baja': additionalWater = 0; break;
                    }
                    
                    const totalWater = baseWater + additionalWater;
                    
                    return `<div class="info-card p-3 sm:p-4 rounded-lg chat-message">
                        <strong>üíß RECOMENDACI√ìN DE HIDRATACI√ìN</strong>
                        <p class="mt-2 text-sm">Seg√∫n tu nivel de actividad (<strong>${data.activityLevel}</strong>):</p>
                        <p class="mt-2 font-bold text-lg">${totalWater} ml - ${totalWater/1000} litros diarios</p>
                        <p class="mt-2 text-sm">üí° <strong>Consejos:</strong></p>
                        <ul class="list-disc list-inside text-sm">
                            <li>Bebe 500ml extra por hora de ejercicio intenso</li>
                            <li>Consume agua antes de tener sed</li>
                            <li>Incluye alimentos ricos en agua (frutas, verduras)</li>
                        </ul>
                    </div>`;
                },
                options: [
                    { text: "üíß M√°s Info Hidrataci√≥n", nextState: 'hydration_tips' },
                    { text: "‚Äπ Volver", nextState: 'hydration_info' }
                ]
            },

            'hydration_tips': {
                message: `<div class="info-card p-3 sm:p-4 rounded-lg chat-message">
                    <strong>üíß CONSEJOS DE HIDRATACI√ìN</strong>
                    <ul class="list-disc list-inside mt-2 space-y-2 text-sm">
                        <li><strong>Bebe antes de tener sed:</strong> La sed es el primer signo de deshidrataci√≥n</li>
                        <li><strong>Agua con electrolitos:</strong> Para entrenamientos largos o intensos</li>
                        <li><strong>Monitorea tu orina:</strong> Color amarillo claro indica buena hidrataci√≥n</li>
                        <li><strong>Hidrataci√≥n post-entreno:</strong> Recupera el 150% del peso perdido durante el ejercicio</li>
                    </ul>
                </div>`,
                options: [
                    { text: "‚Äπ Volver", nextState: 'hydration_info' }
                ]
            },

            // SUPLEMENTOS
            'info_suplementos': {
                message: `<div class="info-card p-3 sm:p-4 rounded-lg chat-message">
                    <p class="font-bold text-blue-800 dark:text-blue-200 text-sm sm:text-base">üíä INFORMACI√ìN SOBRE SUPLEMENTOS</p>
                    <p class="mt-2 text-sm">Los suplementos pueden ser √∫tiles, pero recuerda que son solo eso: un <strong>complemento</strong> a una buena base nutricional y de entrenamiento.</p>
                    
                    <div class="mt-3">
                        <p class="text-sm"><strong>üîπ Suplementos b√°sicos recomendados:</strong></p>
                        <ul class="list-disc list-inside mt-1 text-sm">
                            <li><strong>Prote√≠na en polvo:</strong> Conveniente para alcanzar tus metas de prote√≠na diaria</li>
                            <li><strong>Creatina monohidratada:</strong> Mejora el rendimiento en ejercicios de alta intensidad</li>
                            <li><strong>Omega-3:</strong> Importante para la salud cardiovascular y antiinflamaci√≥n</li>
                            <li><strong>Vitamina D:</strong> Especialmente si tienes poca exposici√≥n solar</li>
                        </ul>
                    </div>

                    <div class="mt-3 p-3 bg-yellow-100 dark:bg-yellow-800 rounded text-sm">
                        <p><strong>‚ö†Ô∏è Importante:</strong> Consulta con un profesional antes de comenzar cualquier suplementaci√≥n, especialmente si tienes condiciones m√©dicas preexistentes.</p>
                    </div>
                </div>`,
                options: [ { text: "‚Äπ Volver", nextState: 'learn_pyramid_level5' } ]
            }
        };

        // Funciones auxiliares (las mismas del c√≥digo anterior)
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typing-indicator';
            typingDiv.innerHTML = `<div class="flex items-start space-x-1 p-3"><div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce-slow"></div><div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce-slow" style="animation-delay: 0.1s"></div><div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce-slow" style="animation-delay: 0.2s"></div></div>`;
            chatWindow.appendChild(typingDiv);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function hideTypingIndicator() {
            const typing = document.getElementById('typing-indicator');
            if (typing) typing.remove();
        }

        function addMessage(sender, htmlContent, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('flex', 'items-start', 'max-w-md', 'rounded-xl', 'p-3', 'transition-opacity', 'duration-500', 'opacity-0');
            if (isUser) {
                messageDiv.classList.add('bg-red-500', 'text-white', 'self-end', 'rounded-br-none');
                messageDiv.textContent = htmlContent;
            } else {
                messageDiv.classList.add('self-start', 'rounded-bl-none');
                messageDiv.innerHTML = `<div class="bot-message-content">${htmlContent}</div>`;
            }
            chatWindow.appendChild(messageDiv);
            setTimeout(() => messageDiv.classList.remove('opacity-0'), 10);
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        function displayCurrentState() {
            const state = conversationTree[conversationState];
            if (!state) return;
            
            showTypingIndicator();
            
            setTimeout(() => {
                hideTypingIndicator();
                if (state.getMessage) {
                    addMessage('bot', state.getMessage(userData));
                } else {
                    addMessage('bot', state.message);
                }

                optionsContainer.innerHTML = '';
                inputContainer.classList.add('hidden');
                
                if (state.options) {
                    state.options.forEach(option => {
                        const button = document.createElement('button');
                        button.textContent = option.text;
                        button.classList.add('option-btn', 'bg-red-100', 'dark:bg-red-900', 'text-red-800', 'dark:text-red-200', 'py-2', 'px-4', 'rounded-full', 'font-semibold', 'text-sm', 'mb-1');
                        button.addEventListener('click', () => {
                            addMessage('user', option.text, true);
                            if (option.value && state.action) {
                                state.action(option.value);
                            }
                            conversationState = option.nextState;
                            setTimeout(displayCurrentState, 300);
                        });
                        optionsContainer.appendChild(button);
                    });
                } else if (state.inputType) {
                    inputContainer.classList.remove('hidden');
                    userInput.type = state.inputType;
                    userInput.value = '';
                    userInput.placeholder = 'Escribe tu respuesta aqu√≠...';
                    userInput.focus();
                }
            }, 800);
        }

        function handleTextInput() {
            const state = conversationTree[conversationState];
            const value = userInput.value.trim();
            
            if (!value || !state || !state.inputType) return;
            
            // Validar si el estado tiene una funci√≥n de validaci√≥n
            if (state.validate) {
                const error = state.validate(value);
                if (error) {
                    addMessage('user', value, true);
                    addMessage('bot', `<div class="info-card p-3 rounded"><p class="font-bold text-red-800 dark:text-red-200">‚ùå Error</p><p class="mt-1 text-sm">${error}</p></div>`);
                    userInput.value = '';
                    return;
                }
            }
            
            addMessage('user', value, true);
            conversationState = state.nextState;
            userInput.value = '';
            setTimeout(displayCurrentState, 300);
        }

        // Inicializar event listeners
        sendBtn.addEventListener('click', handleTextInput);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                handleTextInput();
            }
        });

        // Iniciar la conversaci√≥n
        setTimeout(() => displayCurrentState(), 500);

    </script>
</body>
</html>